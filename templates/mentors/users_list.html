{% extends 'mentors/base_mentor.html' %}

{% block mentor_content %}
<div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4">
    <div>
        <h2 class="text-2xl font-bold text-white">Student Management</h2>
        <p class="text-[#5a6278] text-sm">Monitor progress or reset the classroom.</p>
    </div>

    <div class="flex gap-3">
        <!-- Кнопка экспорта -->
        <a href="{% url 'mentors:export_users_csv' %}" class="bg-[#2c2f3b] hover:bg-white hover:text-black text-white border border-white/20 font-bold py-2 px-4 rounded text-sm flex items-center gap-2 transition-all">
            <i data-lucide="download" class="w-4 h-4"></i> EXPORT RESULTS
        </a>

        <!-- Кнопка сброса -->
        <button onclick="document.getElementById('reset-modal').classList.remove('hidden')" class="bg-red-500/10 hover:bg-red-500 text-red-500 hover:text-white border border-red-500/20 font-bold py-2 px-4 rounded text-sm flex items-center gap-2 transition-all shadow-lg hover:shadow-red-500/20">
            <i data-lucide="trash-2" class="w-4 h-4"></i> RESET CLASSROOM
        </button>
    </div>
</div>

<div class="glass-panel rounded-xl border border-[#2c2f3b] overflow-hidden">
    <div class="overflow-x-auto">
        <table class="w-full text-left text-sm">
            <thead class="bg-[#1a1c23] text-[#5a6278] font-mono text-xs uppercase">
                <tr>
                    <th class="px-4 py-3">Rank</th>
                    <th class="px-4 py-3">User</th>
                    <th class="px-4 py-3 text-center">Flags</th>
                    <th class="px-4 py-3 text-right">Score</th>
                </tr>
            </thead>
            <tbody class="divide-y divide-[#2c2f3b]">
                {% for user in users %}
                <tr class="group hover:bg-white/5 transition-colors">
                    <td class="px-4 py-3 font-mono text-[#5a6278]">#{{ forloop.counter }}</td>
                    <td class="px-4 py-3">
                        <div class="flex items-center gap-3">
                            <div class="w-8 h-8 rounded bg-[#2c2f3b] overflow-hidden">
                                <img src="{{ user.avatar_url }}" class="w-full h-full object-cover">
                            </div>
                            <div>
                                <div class="font-bold text-white">{{ user.username }}</div>
                                <div class="text-[10px] text-[#5a6278]">{{ user.email }}</div>
                            </div>
                        </div>
                    </td>
                    <td class="px-4 py-3 text-center font-mono text-white">
                        {{ user.solved_count }}
                    </td>
                    <td class="px-4 py-3 text-right font-mono text-[#9fef00] font-bold">
                        {{ user.total_points }}
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="4" class="px-4 py-12 text-center text-[#5a6278]">
                        <i data-lucide="ghost" class="w-8 h-8 mx-auto mb-2 opacity-50"></i>
                        No students found in the database.
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- DANGER MODAL -->
<!-- Изменено: flex items-start (было center), pt-20 (отступ сверху), чтобы окно было выше -->
<div id="reset-modal" class="fixed inset-0 bg-black/80 z-[100] hidden flex items-start justify-center pt-20 p-4 backdrop-blur-sm overflow-y-auto">
    <div class="glass-panel w-full max-w-md rounded-xl border-2 border-red-500 shadow-[0_0_50px_rgba(239,68,68,0.2)] overflow-hidden relative animate-in fade-in zoom-in duration-200">
        <div class="p-6 bg-red-500/10 border-b border-red-500/20 text-center">
            <div class="w-20 h-20 rounded-full bg-red-500/20 flex items-center justify-center mx-auto mb-4 text-red-500 animate-pulse">
                <i data-lucide="alert-octagon" class="w-10 h-10"></i>
            </div>
            <h2 class="text-2xl font-bold text-white uppercase tracking-wider">System Purge</h2>
            <p class="text-red-400 font-bold mt-1">DANGER ZONE</p>
        </div>

        <div class="p-6">
            <p class="text-[#9ca3af] mb-4 text-center text-sm leading-relaxed">
                This action will <span class="text-white font-bold">PERMANENTLY DELETE</span>:
                <br>1. All student accounts
                <br>2. All solved flags and points
                <br>3. All submission history
                <br><br>
                This is typically done before starting a new class. Challenges and Categories will NOT be deleted.
            </p>

            <form action="{% url 'mentors:reset_platform' %}" method="post" class="space-y-4">
                {% csrf_token %}
                <div>
                    <label class="block text-xs font-bold text-[#5a6278] uppercase mb-2">Type "CONFIRM_RESET" to proceed</label>
                    <input type="text" name="confirm" required class="w-full bg-[#13141b] border border-red-500/50 rounded p-3 text-white focus:outline-none focus:border-red-500 text-center font-mono placeholder-gray-700" placeholder="CONFIRM_RESET">
                </div>

                <div class="flex gap-3 pt-2">
                    <button type="button" onclick="document.getElementById('reset-modal').classList.add('hidden')" class="flex-1 py-3 rounded bg-[#2c2f3b] text-white hover:bg-[#3f4454] transition-colors font-bold text-sm">CANCEL</button>
                    <button type="submit" class="flex-1 py-3 rounded bg-red-600 text-white hover:bg-red-700 transition-colors font-bold text-sm shadow-lg shadow-red-600/20">NUKE DATABASE</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}