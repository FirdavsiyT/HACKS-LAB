{% extends '../base.html' %}

{% block header_title %}profile{% endblock %}

{% block content %}
<section class="max-w-4xl mx-auto fade-in">
    <div class="glass-panel rounded-2xl border border-[#2c2f3b] overflow-visible mt-16 relative shadow-2xl">
        <!-- Banner -->
        <div class="h-32 md:h-40 bg-gradient-to-r from-[#111219] via-[#1a1c23] to-[#111219] rounded-t-2xl relative overflow-hidden">
            <div class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/carbon-fibre.png')] opacity-20"></div>
            <div class="absolute inset-0 bg-gradient-to-t from-[#13141b] to-transparent"></div>
        </div>
        
        <div class="px-6 md:px-10 pb-10">
            <div class="flex flex-col md:flex-row md:justify-between items-center md:items-end -mt-16 mb-8 gap-6 relative z-10">
                <div class="flex flex-col md:flex-row items-center md:items-end gap-6 text-center md:text-left">
                    <div class="w-32 h-32 md:w-36 md:h-36 hexagon bg-[#13141b] p-2 relative shadow-2xl">
                         <div class="w-full h-full hexagon bg-[#9fef00] flex items-center justify-center p-[3px]">
                            <div class="w-full h-full hexagon bg-[#1a1c23] overflow-hidden">
                                <img src="{{ user.avatar_url }}" alt="Avatar" class="w-full h-full object-cover">
                            </div>
                         </div>
                         <div class="absolute bottom-0 right-0 bg-[#13141b] rounded-full p-1 border border-[#2c2f3b]">
                             <div class="w-4 h-4 bg-[#9fef00] rounded-full border-2 border-[#13141b]"></div>
                         </div>
                    </div>
                    <div class="pb-2">
                        <h2 class="text-3xl font-bold text-white tracking-tight mb-1">{{ user.username }}</h2>
                    </div>
                </div>
            </div>

            <!-- Stats Grid -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 pt-6">
                <div class="glass-panel p-4 rounded-xl text-center border border-[#2c2f3b] hover:border-[#9fef00]/30 transition-colors">
                    <div class="text-3xl font-bold text-white font-mono tracking-tighter">{{ score }}</div>
                    <div class="text-[10px] text-[#5a6278] uppercase font-bold mt-1 tracking-widest">Points</div>
                </div>
                <div class="glass-panel p-4 rounded-xl text-center border border-[#2c2f3b] hover:border-[#9fef00]/30 transition-colors">
                    <div class="text-3xl font-bold text-white font-mono tracking-tighter">#{{ rank }}</div>
                    <div class="text-[10px] text-[#5a6278] uppercase font-bold mt-1 tracking-widest">Global Rank</div>
                </div>
                 <div class="glass-panel p-4 rounded-xl text-center border border-[#2c2f3b] hover:border-[#9fef00]/30 transition-colors">
                    <div class="text-3xl font-bold text-white font-mono tracking-tighter">{{ flags_count }}</div>
                    <div class="text-[10px] text-[#5a6278] uppercase font-bold mt-1 tracking-widest">Flags</div>
                </div>
                 <div class="glass-panel p-4 rounded-xl text-center border border-[#2c2f3b] hover:border-[#9fef00]/30 transition-colors">
                    <div class="text-3xl font-bold text-white font-mono tracking-tighter">{{ accuracy }}</div>
                    <div class="text-[10px] text-[#5a6278] uppercase font-bold mt-1 tracking-widest">Accuracy</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Account Security Section Split -->
    <div class="grid grid-cols-2 gap-6 mt-8">
        
        <!-- Email Settings -->
        <div class="glass-panel rounded-xl p-6 border border-[#2c2f3b] shadow-xl flex flex-col h-full">
            <h3 class="text-lg font-bold text-white mb-6 flex items-center gap-2">
                <i data-lucide="mail" class="w-5 h-5 text-[#9fef00]"></i>
                Email Settings
            </h3>
            <form method="POST" class="flex-1 flex flex-col gap-5">
                {% csrf_token %}
                <input type="hidden" name="action" value="update_email">
                
                <div>
                    <label class="block text-[10px] font-bold text-[#5a6278] uppercase tracking-widest mb-2">New Email Address</label>
                    <div class="input-group flex bg-[#13141b] border border-[#2c2f3b] rounded transition-colors overflow-hidden focus-within:border-[#9fef00] focus-within:shadow-[0_0_0_1px_#9fef00]">
                        <div class="px-3 py-3 border-r border-[#2c2f3b] bg-[#1a1c23] text-[#5a6278]">
                            <i data-lucide="mail" class="w-4 h-4"></i>
                        </div>
                        <input type="email" name="email" value="{{ user.email }}" placeholder="user@example.com" required class="w-full bg-transparent text-white text-sm px-4 py-3 focus:outline-none font-mono">
                    </div>
                </div>

                <div>
                    <label class="block text-[10px] font-bold text-[#5a6278] uppercase tracking-widest mb-2">Current Password</label>
                    <div class="input-group flex bg-[#13141b] border border-[#2c2f3b] rounded transition-colors overflow-hidden focus-within:border-[#9fef00] focus-within:shadow-[0_0_0_1px_#9fef00]">
                        <div class="px-3 py-3 border-r border-[#2c2f3b] bg-[#1a1c23] text-[#5a6278]">
                            <i data-lucide="lock" class="w-4 h-4"></i>
                        </div>
                        <input type="password" name="password" placeholder="Confirm with password" required class="w-full bg-transparent text-white text-sm px-4 py-3 focus:outline-none font-mono">
                    </div>
                </div>
                
                <div class="mt-auto pt-4 flex justify-end">
                    <button type="submit" class="bg-[#9fef00] hover:bg-[#8cd600] text-[#13141b] font-bold px-6 py-2.5 rounded text-sm uppercase tracking-wider transition-all shadow-[0_0_15px_rgba(159,239,0,0.2)] hover:shadow-[0_0_25px_rgba(159,239,0,0.4)]">
                        Update Email
                    </button>
                </div>
            </form>
        </div>

        <!-- Password Settings -->
        <div class="glass-panel rounded-xl p-6 border border-[#2c2f3b] shadow-xl flex flex-col h-full">
            <h3 class="text-lg font-bold text-white mb-6 flex items-center gap-2">
                <i data-lucide="lock" class="w-5 h-5 text-[#9fef00]"></i>
                Security
            </h3>
            <form method="POST" class="flex-1 flex flex-col gap-5">
                 {% csrf_token %}
                 <input type="hidden" name="action" value="update_password">

                 <div>
                    <label class="block text-[10px] font-bold text-[#5a6278] uppercase tracking-widest mb-2">Current Password</label>
                    <div class="input-group flex bg-[#13141b] border border-[#2c2f3b] rounded transition-colors overflow-hidden focus-within:border-[#9fef00] focus-within:shadow-[0_0_0_1px_#9fef00]">
                        <div class="px-3 py-3 border-r border-[#2c2f3b] bg-[#1a1c23] text-[#5a6278]">
                            <i data-lucide="unlock" class="w-4 h-4"></i>
                        </div>
                        <input type="password" name="current_password" placeholder="••••••••" required class="w-full bg-transparent text-white text-sm px-4 py-3 focus:outline-none font-mono">
                    </div>
                </div>

                 <div>
                    <label class="block text-[10px] font-bold text-[#5a6278] uppercase tracking-widest mb-2">New Password</label>
                    <div class="input-group flex bg-[#13141b] border border-[#2c2f3b] rounded transition-colors overflow-hidden focus-within:border-[#9fef00] focus-within:shadow-[0_0_0_1px_#9fef00]">
                        <div class="px-3 py-3 border-r border-[#2c2f3b] bg-[#1a1c23] text-[#5a6278]">
                            <i data-lucide="key" class="w-4 h-4"></i>
                        </div>
                        <input type="password" name="new_password" placeholder="••••••••" required class="w-full bg-transparent text-white text-sm px-4 py-3 focus:outline-none font-mono">
                    </div>
                </div>
                
                <!-- Confirm New Password (Optional, logic not implemented in view for simplicity but field is here) -->
                <div>
                    <label class="block text-[10px] font-bold text-[#5a6278] uppercase tracking-widest mb-2">Confirm Password</label>
                    <div class="input-group flex bg-[#13141b] border border-[#2c2f3b] rounded transition-colors overflow-hidden focus-within:border-[#9fef00] focus-within:shadow-[0_0_0_1px_#9fef00]">
                        <div class="px-3 py-3 border-r border-[#2c2f3b] bg-[#1a1c23] text-[#5a6278]">
                            <i data-lucide="check-circle" class="w-4 h-4"></i>
                        </div>
                        <input type="password" placeholder="••••••••" class="w-full bg-transparent text-white text-sm px-4 py-3 focus:outline-none font-mono">
                    </div>
                </div>

                 <div class="mt-auto pt-4 flex justify-end">
                    <button type="submit" class="bg-[#9fef00] hover:bg-[#8cd600] text-[#13141b] font-bold px-6 py-2.5 rounded text-sm uppercase tracking-wider transition-all shadow-[0_0_15px_rgba(159,239,0,0.2)] hover:shadow-[0_0_25px_rgba(159,239,0,0.4)]">
                        Update Password
                    </button>
                 </div>
            </form>
        </div>
    </div>
</section>
{% endblock %}